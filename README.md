# Prisma Emitter Extension

A Prisma extension to emit events on CRUD operations based on configurable listeners.

## Installation

```bash
npm install prisma-emitter-extension
```

## Basic Usage

1. **Register Listeners & Extend Prisma**

```ts
import { PrismaClient } from '@prisma/client';
import { listenerExtensionConfig, addEventListener } from 'prisma-emitter-extension';

prismaEventListener('User', {
  on: { status: ['ACTIVE', 'INACTIVE'] },
  listener: async ({ result }) => {
    console.log('User #'+ result.id + ' status changed to ' + result.status);
  },
});

export const prisma = new PrismaClient().$extends(listenerExtensionConfig());
```

2. **Trigger Listeners**

```ts
await prisma.user.update({
  where: { id: 1 },
  data: { status: 'ACTIVE' },
  emit: true
});
```

## CLI: Generate Type Augmentations

To automatically add `emit?: boolean` to all your Prisma CRUD args, use our CLI:

```bash
npx prisma-emitter generate --schema ./prisma/schema.prisma --output ./types
```

This will create `./types/prisma-emit.d.ts`:

```ts
// Generated by prisma-emitter-extension
import { Prisma } from '@prisma/client'
declare module '@prisma/client' {
  namespace Prisma {
    interface UserCreateArgs { emit?: boolean }
    interface UserUpdateArgs { emit?: boolean }
    interface UserUpsertArgs { emit?: boolean }
    // â€¦and so on for every model
  }
}
```